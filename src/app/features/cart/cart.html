
<!-- Hero Section -->
<section class="bg-gradient-to-br from-gray-600 to-gray-900 py-8 sm:py-14 pt-20 sm:pt-24">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-2">
        MI CARRITO ğŸ›’
      </h1>
      <p class="text-lg sm:text-xl text-gray-200 max-w-2xl mx-auto">
        Revisa y confirma tus productos antes del pago
      </p>
    </div>
  </div>
</section>

<!-- Cart Content -->
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div *ngIf="cart$ | async as cart" class="max-w-4xl mx-auto">
    <!-- BotÃ³n limpiar carrito -->
    <div *ngIf="cart.items.length > 0" class="mb-6">
      <button 
        (click)="clearCart()" 
        class="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-semibold hover:bg-red-200 transition-colors"
        [disabled]="isLoading">
        ğŸ—‘ï¸ Vaciar Carrito
      </button>
    </div>

    <!-- Carrito vacÃ­o -->
    <div *ngIf="cart.items.length === 0" class="text-center py-16">
      <div class="text-8xl mb-6">ğŸ›’</div>
      <h3 class="text-2xl font-semibold text-gray-700 mb-4">Tu carrito estÃ¡ vacÃ­o</h3>
      <p class="text-gray-600 mb-8">Agrega algunos muebles hermosos a tu carrito</p>
      <a 
        routerLink="/products" 
        class="inline-block bg-amber-700 text-white px-8 py-3 rounded-lg font-semibold hover:bg-amber-800 transition-colors">
        ğŸª‘ Continuar Comprando
      </a>
    </div>

    <!-- Items del carrito -->
    <div *ngIf="cart.items.length > 0" class="space-y-4 mb-8">
      <div *ngFor="let item of cart.items" 
           class="bg-white border border-gray-200 rounded-xl shadow-sm p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row gap-4">
          <!-- Imagen del producto -->
          <div class="flex-shrink-0">
            <img 
              [src]="item.productImageUrl" 
              [alt]="item.productName" 
              class="w-24 h-24 sm:w-32 sm:h-32 object-contain bg-gray-50 rounded-lg" />
          </div>
          
          <!-- Detalles del producto -->
          <div class="flex-1 min-w-0">
            <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ item.productName }}</h3>
            <p class="text-sm text-gray-600 mb-1">{{ item.productDescription }}</p>
            <p class="text-sm text-gray-500 mb-2">{{ item.productCategory }}</p>
            <p class="text-lg font-bold text-amber-700">{{ formatPrice(item.productPrice) }}</p>
          </div>

          <!-- Controles de cantidad -->
          <div class="flex items-center gap-3">
            <div class="flex items-center border border-gray-300 rounded-lg">
              <button 
                (click)="decreaseQuantity(item)" 
                class="p-2 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="isLoading">
                -
              </button>
              
              <input 
                type="number" 
                [value]="item.quantity" 
                (change)="updateQuantity(item, $event)"
                class="w-16 text-center border-0 focus:ring-0"
                min="1"
                [disabled]="isLoading" />
              
              <button 
                (click)="increaseQuantity(item)" 
                class="p-2 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="isLoading">
                +
              </button>
            </div>

            <!-- Total del item -->
            <div class="text-right min-w-0">
              <p class="text-lg font-bold text-gray-800">
                {{ formatPrice(item.productPrice * item.quantity) }}
              </p>
            </div>

            <!-- BotÃ³n eliminar -->
            <button 
              (click)="removeItem(item)" 
              class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50"
              [disabled]="isLoading"
              title="Eliminar producto">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Resumen del carrito -->
    <div *ngIf="cart.items.length > 0" class="bg-white border border-gray-200 rounded-xl shadow-sm p-6">
      <!-- SelecciÃ³n de direcciÃ³n -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“ DirecciÃ³n de entrega</h3>
        
        <div class="space-y-3">
          <div *ngFor="let address of addresses" 
              class="border rounded-lg p-3 cursor-pointer transition-colors"
              [class.border-amber-500]="selectedAddressId === address.id"
              [class.bg-amber-50]="selectedAddressId === address.id"
              [class.border-gray-200]="selectedAddressId !== address.id"
              (click)="selectAddress(address.id!)"
              [class.opacity-50]="isProcessing">
            <div class="flex items-center">
              <input type="radio" 
                    [checked]="selectedAddressId === address.id"
                    [value]="address.id"
                    name="address"
                    [disabled]="isProcessing"
                    class="mr-3 text-amber-600">
              <div>
               <span class="font-medium text-gray-800">{{ address.name }}</span>
                <p class="text-sm text-gray-600">{{ address.street }}</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- BotÃ³n para agregar nueva direcciÃ³n -->
        <button class="mt-3 text-amber-600 text-sm font-medium hover:text-amber-700 disabled:opacity-50"
                [disabled]="isProcessing">
          + Agregar nueva direcciÃ³n
        </button>
        
        <p class="text-sm text-gray-500 mt-2">
          ğŸ’¡ Tip: Puedes agregar mÃ¡s direcciones en tu perfil
        </p>
      </div>

      <!-- Resumen de costos -->
      <div class="border-t border-gray-200 pt-4 mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ’° Resumen del pedido</h3>
        <div class="space-y-2">
          <div class="flex justify-between text-gray-600">
            <span>ArtÃ­culos ({{ getItemsCount() }}):</span>
            <span>{{ formatPrice(getCartTotal()) }}</span>
          </div>
          <div class="flex justify-between text-gray-600">
            <span>EnvÃ­o:</span>
            <span class="text-green-600">GRATIS</span>
          </div>
          <div class="border-t border-gray-200 pt-2 mt-2">
            <div class="flex justify-between text-lg font-bold text-gray-800">
              <span>Total:</span>
              <span class="text-amber-700">{{ formatPrice(getCartTotal()) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Estado del checkout -->
      <div *ngIf="selectedAddressId" class="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
        <div class="flex items-center text-green-700">
          <span class="mr-2">âœ…</span>
          <span class="text-sm font-medium">Listo para procesar el pago</span>
        </div>
      </div>

      <div *ngIf="!selectedAddressId" class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
        <div class="flex items-center text-yellow-700">
          <span class="mr-2">âš ï¸</span>
          <span class="text-sm font-medium">Selecciona una direcciÃ³n de entrega para continuar</span>
        </div>
      </div>
      
      <!-- Botones de acciÃ³n -->
      <div class="flex flex-col sm:flex-row gap-3">
        <a 
          routerLink="/products" 
          class="flex-1 text-center py-3 px-6 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
          ğŸª‘ Continuar Comprando
        </a>
        <button 
          (click)="processCheckout()"
          [disabled]="!selectedAddressId || isProcessing || cart.items.length === 0"
          class="flex-1 bg-amber-700 text-white py-3 px-6 rounded-lg font-semibold hover:bg-amber-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
          <span *ngIf="!isProcessing">ğŸ’³ Proceder al Pago</span>
          <span *ngIf="isProcessing" class="flex items-center justify-center gap-2">
            <svg class="animate-spin h-5 w-5" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
            Procesando...
          </span>
        </button>
      </div>

      <!-- InformaciÃ³n adicional -->
      <div class="mt-6 bg-blue-50 rounded-lg p-4">
        <h4 class="font-semibold text-blue-800 mb-2">ğŸ”’ Pago seguro</h4>
        <div class="text-sm text-blue-700">
          <p>â€¢ Pagos procesados de forma segura</p>
          <p>â€¢ InformaciÃ³n encriptada SSL</p>
          <p>â€¢ GarantÃ­a de satisfacciÃ³n 100%</p>
        </div>
      </div>
    </div>
  </div>
</div>
